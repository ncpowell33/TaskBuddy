<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Buddy</title>
    <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: 'Comic Neue', sans-serif;
            background-color: #f0f8ff;
            text-align: center;
            padding: 20px;
            margin-bottom: 100px;
            position: relative;
        }
        h1, h2, h3 {
            font-family: 'Chewy', cursive;
            color: #4682b4;
        }
        #coin-counter {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: #32cd32;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 5px;
            font-family: 'Chewy', cursive;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #coin-counter i {
            font-size: 20px;
            color: #ffd700;
        }
        #streak-counter {
            font-size: 24px;
            color: #ff4500;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 5px;
            font-family: 'Chewy', cursive;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 5px;
        }
        #streak-counter i {
            font-size: 20px;
            color: #ff4500;
        }
        #help-icon {
            font-size: 20px;
            color: #4682b4;
            cursor: pointer;
            transition: color 0.2s;
            margin-left: 10px;
        }
        #help-icon:hover {
            color: #5a9bd4;
        }
        #task-section, #timer-section, #buddies-section, #category-buddies-section, #collection-section {
            margin: 20px auto;
            width: 80%;
            max-width: 500px;
        }
        #task-section {
            display: block;
        }
        #timer-section, #buddies-section, #category-buddies-section, #collection-section {
            display: none;
        }
        .task, .buddy, .collection-item {
            background-color: #fff;
            border: 2px solid #4682b4;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: opacity 0.5s ease-out;
        }
        .task.dragging {
            opacity: 0.5;
        }
        .task.completed {
            opacity: 0;
            background-color: #32cd32;
        }
        .task.completed::before {
            content: "\f00c";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: white;
            margin-right: 5px;
        }
        .buddy.purchased {
            opacity: 0;
        }
        .task-buttons {
            display: flex;
            gap: 5px;
        }
        .delete-task, .edit-task {
            background: none;
            border: none;
            color: #ff4500;
            font-size: 18px;
            cursor: pointer;
            transition: color 0.2s;
            padding: 5px;
        }
        .edit-task {
            color: #4682b4;
        }
        .delete-task:hover {
            color: #ff6347;
        }
        .edit-task:hover {
            color: #5a9bd4;
        }
        #timer {
            background-color: #ffebcd;
            border: 5px solid #ff4500;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }
        #timer-display {
            font-size: 48px;
            font-weight: bold;
            color: #ff4500;
            margin: 10px 0;
            text-shadow: 2px 2px 4px #ffbb33;
            font-family: 'Chewy', cursive;
        }
        #timer-inputs {
            margin: 10px 0;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        #timer-minutes {
            width: 80px;
            padding: 8px;
            font-size: 18px;
            font-family: 'Chewy', cursive;
            background-color: #fffacd;
            border: 3px solid #4682b4;
            border-radius: 10px;
            text-align: center;
            color: #4682b4;
        }
        #timer-minutes:focus {
            outline: none;
            border-color: #ff4500;
            box-shadow: 0 0 5px #ff4500;
        }
        #category-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px auto;
            max-width: 1200px;
            padding: 0 20px;
        }
        .category-button {
            background-color: #4682b4;
            color: white;
            border: none;
            padding: 80px;
            border-radius: 15px;
            font-family: 'Chewy', cursive;
            font-size: 40px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), inset 0 0 10px rgba(255, 255, 255, 0.5);
            background: linear-gradient(145deg, #5a9bd4, #4682b4);
            transition: transform 0.1s, box-shadow 0.1s;
            flex: 0 1 auto;
        }
        .category-button:hover {
            background: linear-gradient(145deg, #6ab0e8, #5a9bd4);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.7);
        }
        .category-button:active {
            transform: translateY(5px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2), inset 0 0 5px rgba(255, 255, 255, 0.3);
        }
        #category-buddies-section h2 {
            margin-bottom: 20px;
        }
        #category-buddies {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            max-width: 800px;
        }
        .buddy img, .collection-item img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
            object-fit: cover;
            animation: bounce 1s infinite;
        }
        .buddy img:hover, .collection-item img:hover {
            animation: spin 1s linear infinite;
        }
        .rarity-epic img {
            animation: pulse 1.5s infinite;
        }
        .buddy.purchased {
            background-color: #ffd700;
        }
        .rarity {
            font-size: 12px;
            padding: 2px 5px;
            border-radius: 3px;
            margin-left: 5px;
        }
        .rarity-common { color: #808080; background-color: #d3d3d3; }
        .rarity-uncommon { color: #006400; background-color: #90ee90; }
        .rarity-rare { color: #0000ff; background-color: #add8e6; }
        .rarity-epic { 
            color: #800080; 
            background: linear-gradient(145deg, #dda0dd, #ba55d3); 
            box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.5); 
        }
        .rarity-legendary { 
            color: #ff4500; 
            background: linear-gradient(145deg, #ffdead, #ff8c00); 
            box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.5); 
        }
        .rarity-mythic { 
            color: #ffd700; 
            background: linear-gradient(145deg, #fffacd, #ffcc00); 
            box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.5); 
        }
        button {
            background-color: #4682b4;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s, box-shadow 0.1s;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        button:hover {
            background-color: #5a9bd4;
        }
        button:active {
            transform: translateY(5px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        #task-form {
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        input[type="text"] {
            padding: 5px;
            width: 60%;
            max-width: 300px;
            font-family: 'Comic Neue', sans-serif;
        }
        #settings-icon {
            font-size: 20px;
            color: #4682b4;
            cursor: pointer;
            transition: color 0.2s;
        }
        #settings-icon:hover {
            color: #5a9bd4;
        }
        #bottom-buttons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }
        #tasks-btn {
            background-color: #ff69b4;
        }
        #tasks-btn:hover {
            background-color: #ff85c2;
        }
        #timer-btn {
            background-color: #ffa500;
        }
        #timer-btn:hover {
            background-color: #ffbb33;
        }
        #buddies-btn {
            background-color: #4682b4;
        }
        #buddies-btn:hover {
            background-color: #5a9bd4;
        }
        #collection-btn {
            background-color: #9370db;
        }
        #collection-btn:hover {
            background-color: #a68be3;
        }
        .action-button {
            background-color: #4682b4;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Chewy', cursive;
        }
        .action-button:hover {
            background-color: #5a9bd4;
        }
        #progress-bar {
            width: 80%;
            height: 30px;
            margin: 20px auto;
            background-color: #fffacd;
            border: 3px solid #4682b4;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            display: none;
        }
        #progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4500, #ffbb33);
            width: 0%;
            transition: width 1s linear;
            position: relative;
            overflow: hidden;
        }
        #progress-wave {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            animation: wave 4s infinite linear;
        }
        @keyframes wave {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        @keyframes mario-grow {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }
        .mario-grow-animation {
            animation: mario-grow 1s ease-in-out;
        }
        #collection-count {
            font-family: 'Chewy', cursive;
            color: #4682b4;
            font-size: 20px;
            margin-bottom: 10px;
        }
        .category-group {
            margin-bottom: 20px;
        }
        #notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ff4500;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-family: 'Chewy', cursive;
            font-size: 18px;
            display: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }
        #back-button {
            margin-top: 20px;
            background-color: #ff4500;
            padding: 10px 20px;
            font-size: 20px;
        }
        #back-button:hover {
            background-color: #ff6347;
        }
        #passcode-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            width: 80%;
            max-width: 400px;
            text-align: center;
        }
        #passcode-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1500;
            display: none;
        }
        #passcode-input {
            font-size: 24px;
            padding: 10px;
            width: 150px;
            margin: 20px 0;
            border: 3px solid #4682b4;
            border-radius: 10px;
            font-family: 'Chewy', cursive;
            text-align: center;
        }
        #passcode-submit {
            background-color: #4682b4;
            padding: 10px 20px;
            font-size: 18px;
        }
        #passcode-submit:hover {
            background-color: #5a9bd4;
        }
        #passcode-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #ff4500;
            font-size: 20px;
            cursor: pointer;
            transition: color 0.2s;
        }
        #passcode-close:hover {
            color: #ff6347;
        }
        #delete-confirm-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            width: 80%;
            max-width: 300px;
            text-align: center;
        }
        #delete-confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1500;
            display: none;
        }
        #delete-confirm-yes {
            background-color: #ff4500;
            padding: 10px 20px;
            font-size: 18px;
            margin-right: 10px;
        }
        #delete-confirm-yes:hover {
            background-color: #ff6347;
        }
        #delete-confirm-no {
            background-color: #4682b4;
            padding: 10px 20px;
            font-size: 18px;
        }
        #delete-confirm-no:hover {
            background-color: #5a9bd4;
        }
        #recommended-tasks {
            margin-top: 20px;
            padding: 10px;
            background-color: #fff;
            border: 2px solid #4682b4;
            border-radius: 5px;
            width: 80%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
        }
        #recommended-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .recommended-task {
            background-color: #4682b4;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Chewy', cursive;
            transition: background-color 0.2s;
        }
        .recommended-task:hover {
            background-color: #5a9bd4;
        }
        #shuffle-tasks {
            background-color: #ff69b4;
            width: 40px;
            height: 40px;
            font-size: 16px;
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        #shuffle-tasks:hover {
            background-color: #ff85c2;
        }
        @media (max-width: 600px) {
            button {
                width: 70px;
                height: 70px;
                font-size: 28px;
            }
            #bottom-buttons {
                gap: 10px;
                padding-bottom: 10px;
            }
            #task-form {
                flex-direction: column;
                gap: 15px;
            }
            input[type="text"] {
                width: 80%;
                padding: 8px;
            }
            #category-buttons {
                flex-direction: column;
                align-items: center;
            }
            .category-button {
                padding: 40px;
                font-size: 24px;
                width: 80%;
                max-width: 300px;
            }
            .task, .buddy, .collection-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .task-buttons {
                width: 100%;
                justify-content: space-between;
            }
            #timer-minutes {
                width: 100px;
                font-size: 16px;
            }
            #timer-display {
                font-size: 36px;
            }
            .recommended-task {
                padding: 6px 10px;
                font-size: 14px;
            }
        }
        #recommended-tasks {
            padding-bottom: 50px;
            position: relative;
        }
        #recommended-list {
            min-height: 60px;
        }
        #shuffle-tasks {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            font-size: 16px;
            z-index: 1;
        }
        .collection-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
        }
        .collection-item .level-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .collection-item .level {
            font-size: 14px;
            color: #4682b4;
            font-weight: bold;
        }
        .collection-item .upgrade-btn {
            background-color: #32cd32;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Chewy', cursive;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .collection-item .upgrade-btn:hover {
            background-color: #3cb371;
        }
        .collection-item .upgrade-btn:disabled {
            background-color: #a9a9a9;
            cursor: not-allowed;
        }
        .collection-item .level {
            font-size: 18px;
            font-weight: 900;
            color: #4682b4;
        }
        .collection-item .upgrade-btn {
            position: relative;
            overflow: hidden;
            padding: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .collection-item .upgrade-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.5),
                transparent
            );
            animation: shiny 2s infinite linear;
        }
        @keyframes shiny {
            0% { transform: translateX(-100%) translateY(-100%); }
            100% { transform: translateX(100%) translateY(100%); }
        }
        .collection-item .title-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .collection-item .upgrade-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .collection-item .upgrade-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            animation: wave 4s infinite linear;
        }
        .collection-item .upgrade-cost {
            font-size: 12px;
            color: #32cd32;
            font-family: 'Chewy', cursive;
            display: flex;
            align-items: center;
            gap: 3px;
        }
        .collection-item .upgrade-cost i {
            font-size: 14px;
            color: #ffd700;
        }
        #account-level {
            position: absolute;
            top: 20px;
            right: 150px;
            font-size: 24px;
            color: #4682b4;
            font-family: 'Chewy', cursive;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #level-progress-bar {
            width: 200px;
            height: 20px;
            background-color: #fffacd;
            border: 3px solid #4682b4;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        #level-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4682b4, #5a9bd4);
            width: 0%;
            transition: width 0.5s ease-in-out;
            position: relative;
            overflow: hidden;
        }
        #level-progress-wave {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            animation: wave 4s infinite linear;
        }
        #level-progress-bar {
            background: linear-gradient(to bottom, #fffacd, #f0e68c);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2), inset 0 -2px 4px rgba(255, 255, 255, 0.5);
            border: 3px solid #2f5a7a;
        }
        #level-progress-fill {
            background: linear-gradient(to bottom, #4682b4, #3a6e93);
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3), inset 0 -2px 4px rgba(0, 0, 0, 0.2);
        }
        #level-up-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ffd700;
            color: #4682b4;
            padding: 20px 40px;
            border-radius: 15px;
            font-family: 'Chewy', cursive;
            font-size: 36px;
            display: none;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            z-index: 2000;
            text-align: center;
            animation: bounce 0.5s infinite alternate;
        }
        @keyframes heart-pop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
        .heart {
            position: absolute;
            color: #ff69b4;
            font-size: 20px;
            animation: heart-pop 1s ease-out forwards;
            pointer-events: none;
        }
        #help-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1500;
            display: none;
        }
        #help-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            width: 80%;
            max-width: 600px;
            text-align: left;
            max-height: 80vh;
            overflow-y: auto;
        }
        #help-popup h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        #help-popup p {
            font-size: 16px;
            line-height: 1.5;
            margin: 10px 0;
        }
        #help-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #ff4500;
            font-size: 20px;
            cursor: pointer;
            transition: color 0.2s;
        }
        #help-close:hover {
            color: #ff6347;
        }
        #daily-reward-btn {
            background-color: #32cd32;
            margin: 10px auto;
            display: block;
            width: 80px;
            height: 80px;
            font-size: 28px;
        }
        #daily-reward-btn:hover {
            background-color: #3cb371;
        }
        #daily-reward-btn:disabled {
            background-color: #a9a9a9;
            cursor: not-allowed;
        }
        #daily-reward-timer {
            font-family: 'Chewy', cursive;
            font-size: 18px;
            color: #32cd32;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>Task Buddy</h1>
    <div id="account-level">
        Level: <span id="level">1</span>
        <div id="level-progress-bar">
            <div id="level-progress-fill">
                <div id="level-progress-wave"></div>
            </div>
        </div>
    </div>
    <div id="coin-counter"><i class="fas fa-sack-dollar"></i> <span id="coins">0</span></div>
    <div id="notification"></div>
    <div id="level-up-notification"></div>
    <div id="passcode-overlay"></div>
    <div id="passcode-popup">
        <h2>Enter 4-Digit Passcode</h2>
        <input type="number" id="passcode-input" maxlength="4" placeholder="1234">
        <button class="action-button" id="passcode-submit" onclick="submitPasscode()">Submit</button>
        <button id="passcode-close" onclick="hidePasscodePopup()"><i class="fas fa-times"></i></button>
    </div>
    <div id="delete-confirm-overlay"></div>
    <div id="delete-confirm-popup">
        <h2>Are you sure?</h2>
        <p>Do you want to delete this task?</p>
        <button class="action-button" id="delete-confirm-yes" onclick="confirmDelete()">Yes</button>
        <button class="action-button" id="delete-confirm-no" onclick="hideDeleteConfirm()">No</button>
    </div>
    <div id="help-overlay"></div>
    <div id="help-popup">
        <h2>Welcome to Task Buddy!</h2>
        <p>Task Buddy is a fun app to help you get things done and earn rewards! Here’s how it works:</p>
        <p><strong>Tasks:</strong> Add tasks using the input box and click "Add Task" or press Enter. Click "Done" to complete a task (earns 10 coins) or the trash icon to delete it. Check out "Recommended Tasks" for ideas—click one to add it, or shuffle them with the randomize button.</p>
        <p><strong>Timer:</strong> Set a timer in minutes to focus on a task. Earn 25 coins when it finishes! Click "End Timer" to stop early.</p>
        <p><strong>Coins & Streaks:</strong> Earn coins by completing tasks, timers, and claiming your daily reward (10 coins × streak, up to 100). Your streak tracks daily logins—open the app each day to keep it going!</p>
        <p><strong>Leveling Up:</strong> Complete 5 tasks to level up and get 50 bonus coins. Watch your progress bar fill up!</p>
        <p><strong>Buddies:</strong> Spend coins in the "Buddy Store" to buy cool items like food, animals, sports balls, and vehicles. Each has a rarity (Common to Mythic) and cost.</p>
        <p><strong>Collection:</strong> See your purchased buddies here. Click them for a heart animation, and upgrade them (up to Level 10) with coins for extra fun!</p>
        <p><strong>Settings:</strong> Click the gear icon to set a 4-digit passcode for completing tasks (optional). Use it again to turn it off.</p>
        <p>Switch between sections using the bottom buttons: Tasks (pink), Timer (orange), Buddies (blue), Collection (purple). Have fun and stay productive!</p>
        <button id="help-close" onclick="hideHelpPopup()"><i class="fas fa-times"></i></button>
    </div>

    <div id="streak-counter">
        <i class="fas fa-fire"></i> Streak: <span id="streak">0</span>
        <i class="fas fa-question-circle" id="help-icon" onclick="showHelpPopup()"></i>
    </div>
    <div id="daily-reward-timer"></div>
    <button id="daily-reward-btn" onclick="claimDailyReward()"><i class="fas fa-gift"></i></button>

    <div id="task-section">
        <div id="task-form">
            <input type="text" id="new-task" placeholder="Add a new task...">
            <i class="fas fa-cog" id="settings-icon" onclick="toggleSettings()"></i>
            <button class="action-button" onclick="addTask()">Add Task</button>
        </div>
        <div id="task-list">
            <!-- Tasks will be added here dynamically -->
        </div>
        <div id="recommended-tasks">
            <h3>Recommended Tasks</h3>
            <div id="recommended-list">
                <!-- Recommended tasks will be added here dynamically -->
            </div>
            <button id="shuffle-tasks" class="action-button"><i class="fas fa-random"></i></button>
        </div>
    </div>

    <div id="timer-section">
        <div id="timer">
            <div id="timer-inputs">
                <input type="number" id="timer-minutes" placeholder="Minutes" min="1" step="1">
            </div>
            <button class="action-button" id="start-timer" onclick="startTimer()">Start Timer</button>
            <button class="action-button" id="end-timer" onclick="endTimer()" style="display: none;">End Timer</button>
            <div id="timer-display">00:00</div>
            <div id="progress-bar">
                <div id="progress-fill">
                    <div id="progress-wave"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="buddies-section">
        <h2>Buddy Store</h2>
        <div id="category-buttons">
            <button class="category-button" onclick="showCategoryBuddies('Food')">Food</button>
            <button class="category-button" onclick="showCategoryBuddies('Animals')">Animals</button>
            <button class="category-button" onclick="showCategoryBuddies('Sports Balls')">Sports Balls</button>
            <button class="category-button" onclick="showCategoryBuddies('Vehicles')">Vehicles</button>
        </div>
    </div>

    <div id="category-buddies-section">
        <h2 id="category-title"></h2>
        <div id="category-buddies">
            <!-- Category-specific buddies will be added here dynamically -->
        </div>
        <button class="action-button" id="back-button" onclick="showSection('buddies-section')"><i class="fas fa-door-open"></i></button>
    </div>

    <div id="collection-section">
        <h2>My Collection</h2>
        <div id="collection-count"></div>
        <div id="collection-list">
            <!-- Owned items will be added here dynamically -->
        </div>
    </div>

    <div id="bottom-buttons">
        <button id="tasks-btn" onclick="showSection('task-section')"><i class="fas fa-check-double"></i></button>
        <button id="timer-btn" onclick="showSection('timer-section')"><i class="fas fa-clock"></i></button>
        <button id="buddies-btn" onclick="showSection('buddies-section')"><i class="fas fa-shopping-cart"></i></button>
        <button id="collection-btn" onclick="showSection('collection-section')"><i class="fas fa-suitcase"></i></button>
    </div>

    <!-- <audio id="coin-sound" src="https://www.soundjay.com/buttons/coin-drop-1.mp3"></audio> -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script>
        let taskCoins = parseInt(localStorage.getItem("taskCoins")) || 0;
        let streak = parseInt(localStorage.getItem("streak")) || 0;
        let lastLogin = localStorage.getItem("lastLogin") || null;
        let lastRewardDate = localStorage.getItem("lastRewardDate") || null;
        let tasks = JSON.parse(localStorage.getItem("tasks")) || [
            { text: "Brush your teeth", completed: false },
            { text: "Finish homework", completed: false },
            { text: "Tidy your room", completed: false }
        ];
        let buddies = JSON.parse(localStorage.getItem("buddies")) || [
            { name: "Apple", cost: 10, purchased: false, category: "Food", rarity: "Common", imageURL: "apple.jpg", level: 0 },
            { name: "Sandwich", cost: 20, purchased: false, category: "Food", rarity: "Uncommon", imageURL: "sandwich.jpg", level: 0 },
            { name: "Sushi", cost: 30, purchased: false, category: "Food", rarity: "Rare", imageURL: "sushi.jpg", level: 0 },
            { name: "Pizza", cost: 50, purchased: false, category: "Food", rarity: "Epic", imageURL: "pizza.jpg", level: 0 },
            { name: "Cake", cost: 100, purchased: false, category: "Food", rarity: "Legendary", imageURL: "cake.jpg", level: 0 },
            { name: "Golden Feast", cost: 200, purchased: false, category: "Food", rarity: "Mythic", imageURL: "golden-feast.jpg", level: 0 },
            { name: "Goldfish", cost: 10, purchased: false, category: "Animals", rarity: "Common", imageURL: "goldfish.jpg", level: 0 },
            { name: "Rabbit", cost: 20, purchased: false, category: "Animals", rarity: "Uncommon", imageURL: "rabbit.jpg", level: 0 },
            { name: "Cat", cost: 30, purchased: false, category: "Animals", rarity: "Rare", imageURL: "cat.jpg", level: 0 },
            { name: "Dog", cost: 50, purchased: false, category: "Animals", rarity: "Epic", imageURL: "dog.jpg", level: 0 },
            { name: "Elephant", cost: 100, purchased: false, category: "Animals", rarity: "Legendary", imageURL: "elephant.jpg", level: 0 },
            { name: "Dragon", cost: 200, purchased: false, category: "Animals", rarity: "Mythic", imageURL: "dragon.jpg", level: 0 },
            { name: "Tennis Ball", cost: 10, purchased: false, category: "Sports Balls", rarity: "Common", imageURL: "tennis-ball.jpg", level: 0 },
            { name: "Baseball", cost: 20, purchased: false, category: "Sports Balls", rarity: "Uncommon", imageURL: "baseball.jpg", level: 0 },
            { name: "Soccer Ball", cost: 30, purchased: false, category: "Sports Balls", rarity: "Rare", imageURL: "soccer-ball.jpg", level: 0 },
            { name: "Basketball", cost: 50, purchased: false, category: "Sports Balls", rarity: "Epic", imageURL: "basketball.jpg", level: 0 },
            { name: "Golden Ball", cost: 100, purchased: false, category: "Sports Balls", rarity: "Legendary", imageURL: "golden-ball.jpg", level: 0 },
            { name: "Mythic Orb", cost: 200, purchased: false, category: "Sports Balls", rarity: "Mythic", imageURL: "mythic-orb.jpg", level: 0 },
            { name: "Bicycle", cost: 10, purchased: false, category: "Vehicles", rarity: "Common", imageURL: "bicycle.jpg", level: 0 },
            { name: "Scooter", cost: 20, purchased: false, category: "Vehicles", rarity: "Uncommon", imageURL: "scooter.jpg", level: 0 },
            { name: "Car", cost: 30, purchased: false, category: "Vehicles", rarity: "Rare", imageURL: "car.jpg", level: 0 },
            { name: "Truck", cost: 50, purchased: false, category: "Vehicles", rarity: "Epic", imageURL: "truck.jpg", level: 0 },
            { name: "Airplane", cost: 100, purchased: false, category: "Vehicles", rarity: "Legendary", imageURL: "airplane.jpg", level: 0 },
            { name: "Spaceship", cost: 200, purchased: false, category: "Vehicles", rarity: "Mythic", imageURL: "spaceship.jpg", level: 0 }
        ];

        function saveBuddies() {
            localStorage.setItem("buddies", JSON.stringify(buddies));
        }

        let timerInterval = null;
        let timerDuration = 0;
        let timeLeft = 0;
        let usePasscode = localStorage.getItem("usePasscode") === "true" || false;
        let currentPasscode = localStorage.getItem("currentPasscode") || null;
        let pendingTaskIndex = null;
        let accountLevel = parseInt(localStorage.getItem("accountLevel")) || 1;
        let tasksCompleted = parseInt(localStorage.getItem("tasksCompleted")) || 0;
        const tasksPerLevel = 5;

        const allRecommendedTasks = [
            "Finish math homework", "Study for spelling test", "Read 20 minutes", "Practice multiplication facts",
            "Complete book report", "Bring permission slip to school", "Pack backpack for school", "Review vocabulary words",
            "Finish history worksheet", "Work on group project", "Organize desk or school supplies", "Write in journal",
            "Practice handwriting", "Learn new words in a different language", "Turn in homework on time",
            "Bring library book back to school", "Memorize a poem or speech", "Practice presentation for class",
            "Ask teacher for help if needed", "Clean bedroom", "Make bed", "Take out the trash", "Set the table for dinner",
            "Clear the table after eating", "Help with dishes", "Sweep or vacuum floor", "Water the plants", "Feed the pet",
            "Brush the pet", "Take pet for a walk", "Help with laundry", "Put away toys", "Help cook dinner",
            "Organize bookshelf", "Wipe down the counters", "Dust furniture", "Check mail or bring in packages",
            "Help younger sibling with something", "Keep closet organized", "Brush teeth", "Floss teeth",
            "Take a bath or shower", "Comb or brush hair", "Clip nails", "Wash hands before eating", "Put on clean clothes",
            "Drink enough water", "Eat healthy snacks", "Go to bed on time", "Write down school assignments",
            "Finish reading log", "Review for upcoming quiz", "Organize school binder", "Pack lunch for school",
            "Sharpen pencils or charge tablet", "Do extra credit work", "Take notes in class", "Ask questions in class",
            "Finish classwork at home", "Write thank-you note to teacher", "Practice typing skills", "Study flashcards",
            "Finish science research project", "Work on handwriting improvement", "Review old tests for mistakes",
            "Submit homework", "Write essay draft", "Highlight important notes in textbook", "Help a classmate with homework",
            "Check school website for updates", "Get school supplies ready for the next day", "Choose an outfit for school",
            "Bring gym clothes for PE", "Do a chore without being asked", "Pick up clutter around the house",
            "Sort laundry by colors", "Fold and put away clothes", "Organize shoes in the closet", "Wipe down windows or mirrors",
            "Help carry groceries", "Take out recycling", "Restock bathroom with soap and toilet paper", "Sort mail for parents",
            "Sweep the porch or patio", "Straighten up couch pillows", "Refill pet’s water bowl", "Help pack lunches for siblings",
            "Pick up toys from the living room", "Water outdoor plants or garden", "Change pillowcase or sheets",
            "Wash face in the morning and before bed", "Apply lotion to dry skin", "Clean ears carefully",
            "Put dirty clothes in the hamper", "Put on deodorant", "Clean nails", "Brush teeth",
            "Make sure backpack and shoes are ready for tomorrow"
        ];

        let recommendedTasks = [];

        // const coinSound = document.getElementById("coin-sound");

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getRandomRecommendedTasks() {
            const shuffled = shuffleArray([...allRecommendedTasks]);
            recommendedTasks = shuffled.slice(0, 5);
            renderRecommendedTasks();
        }

        function showNotification(message) {
            const notification = document.getElementById("notification");
            notification.innerText = message;
            notification.style.display = "block";
            setTimeout(() => {
                notification.style.display = "none";
            }, 3000);
        }

        function showLevelUpNotification(level) {
            const levelUpNotification = document.getElementById("level-up-notification");
            levelUpNotification.innerText = `Level Up!\nLevel ${level}! +50 coins!`;
            levelUpNotification.style.display = "block";
            setTimeout(() => {
                levelUpNotification.style.display = "none";
            }, 3000);
        }

        function toggleSettings() {
            showPasscodePopup(false);
        }

        function showPasscodePopup(isDisabling = false) {
            document.getElementById("passcode-overlay").style.display = "block";
            document.getElementById("passcode-popup").style.display = "block";
            document.getElementById("passcode-input").value = "";
            document.getElementById("passcode-input").focus();
            document.getElementById("passcode-submit").setAttribute("data-disabling", isDisabling ? "true" : "false");
        }

        function hidePasscodePopup() {
            document.getElementById("passcode-overlay").style.display = "none";
            document.getElementById("passcode-popup").style.display = "none";
            pendingTaskIndex = null;
        }

        function showHelpPopup() {
            document.getElementById("help-overlay").style.display = "block";
            document.getElementById("help-popup").style.display = "block";
        }

        function hideHelpPopup() {
            document.getElementById("help-overlay").style.display = "none";
            document.getElementById("help-popup").style.display = "none";
        }

        function submitPasscode() {
            const passcodeInput = document.getElementById("passcode-input").value;
            const isDisabling = document.getElementById("passcode-submit").getAttribute("data-disabling") === "true";
            if (passcodeInput.length === 4 && /^\d{4}$/.test(passcodeInput)) {
                if (isDisabling) {
                    if (passcodeInput === currentPasscode) {
                        usePasscode = false;
                        currentPasscode = null;
                        localStorage.setItem("usePasscode", usePasscode);
                        localStorage.setItem("currentPasscode", currentPasscode);
                        showNotification("Passcode disabled!");
                        hidePasscodePopup();
                    } else {
                        showNotification("Incorrect passcode!");
                    }
                } else if (!usePasscode && !currentPasscode) {
                    currentPasscode = passcodeInput;
                    usePasscode = true;
                    localStorage.setItem("usePasscode", usePasscode);
                    localStorage.setItem("currentPasscode", currentPasscode);
                    showNotification("Passcode set successfully!");
                    hidePasscodePopup();
                } else if (usePasscode && currentPasscode === passcodeInput && pendingTaskIndex !== null) {
                    completeTaskWithPasscode(pendingTaskIndex);
                    pendingTaskIndex = null;
                    hidePasscodePopup();
                } else {
                    showNotification("Incorrect passcode!");
                }
            } else {
                showNotification("Please enter a 4-digit passcode!");
            }
        }

        function showDeleteConfirm(index) {
            pendingTaskIndex = index;
            document.getElementById("delete-confirm-overlay").style.display = "block";
            document.getElementById("delete-confirm-popup").style.display = "block";
        }

        function hideDeleteConfirm() {
            document.getElementById("delete-confirm-overlay").style.display = "none";
            document.getElementById("delete-confirm-popup").style.display = "none";
            pendingTaskIndex = null;
        }

        function confirmDelete() {
            if (pendingTaskIndex !== null) {
                tasks.splice(pendingTaskIndex, 1);
                renderTasks();
                showNotification("Task deleted!");
                hideDeleteConfirm();
            }
        }

        function updateCoins() {
            document.getElementById("coins").innerText = taskCoins;
            localStorage.setItem("taskCoins", taskCoins);
        }

        function updateStreak() {
            const today = new Date().toDateString();
            if (lastLogin) {
                const lastLoginDate = new Date(lastLogin);
                const yesterday = new Date();
                yesterday.setDate(new Date().getDate() - 1);
                
                if (lastLoginDate.toDateString() === yesterday.toDateString()) {
                    streak += 1;
                } else if (lastLoginDate.toDateString() !== today) {
                    streak = 1;
                }
            } else {
                streak = 1;
            }
            lastLogin = today;
            document.getElementById("streak").innerText = streak;
            localStorage.setItem("streak", streak);
            localStorage.setItem("lastLogin", lastLogin);
            updateDailyRewardButton();
        }

        function updateAccountLevel() {
            document.getElementById("level").innerText = accountLevel;
            const progress = (tasksCompleted % tasksPerLevel) / tasksPerLevel * 100;
            document.getElementById("level-progress-fill").style.width = `${progress}%`;
            localStorage.setItem("accountLevel", accountLevel);
            localStorage.setItem("tasksCompleted", tasksCompleted);
        }

        function renderTasks() {
            const taskList = document.getElementById("task-list");
            taskList.innerHTML = "";
            tasks.forEach((task, index) => {
                if (!task.completed) {
                    const taskDiv = document.createElement("div");
                    taskDiv.className = "task";
                    taskDiv.draggable = true;
                    taskDiv.setAttribute("data-index", index);
                    taskDiv.innerHTML = `
                        <span>${task.text}</span>
                        <div class="task-buttons">
                            <button class="action-button" onclick="completeTask(${index})">Done</button>
                            <button class="edit-task" onclick="editTask(${index})"><i class="fas fa-pencil-alt"></i></button>
                            <button class="delete-task" onclick="showDeleteConfirm(${index})"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    taskList.appendChild(taskDiv);
                }
            });
            localStorage.setItem("tasks", JSON.stringify(tasks));
            renderRecommendedTasks();
            addDragAndDropListeners();
        }

        function editTask(index) {
            const newText = prompt("Edit your task:", tasks[index].text);
            if (newText !== null && newText.trim() !== "") {
                tasks[index].text = newText.trim();
                renderTasks();
                showNotification("Task updated!");
            }
        }

        function addDragAndDropListeners() {
            const taskList = document.getElementById("task-list");
            const taskItems = taskList.querySelectorAll(".task");

            taskItems.forEach(task => {
                task.addEventListener("dragstart", (e) => {
                    task.classList.add("dragging");
                    e.dataTransfer.setData("text/plain", task.getAttribute("data-index"));
                });

                task.addEventListener("dragend", () => {
                    task.classList.remove("dragging");
                });

                task.addEventListener("dragover", (e) => {
                    e.preventDefault();
                });

                task.addEventListener("drop", (e) => {
                    e.preventDefault();
                    const draggedIndex = parseInt(e.dataTransfer.getData("text/plain"));
                    const targetIndex = parseInt(task.getAttribute("data-index"));
                    if (draggedIndex !== targetIndex) {
                        const draggedTask = tasks.splice(draggedIndex, 1)[0];
                        tasks.splice(targetIndex, 0, draggedTask);
                        renderTasks();
                    }
                });
            });
        }

        function renderRecommendedTasks() {
            const recommendedList = document.getElementById("recommended-list");
            recommendedList.innerHTML = "";
            recommendedTasks.forEach(task => {
                if (!tasks.some(t => t.text === task)) {
                    const taskDiv = document.createElement("div");
                    taskDiv.className = "recommended-task";
                    taskDiv.innerText = task;
                    taskDiv.onclick = () => {
                        tasks.push({ text: task, completed: false });
                        renderTasks();
                    };
                    recommendedList.appendChild(taskDiv);
                }
            });
        }

        function showCategoryBuddies(category) {
            showSection('category-buddies-section');
            const categoryTitle = document.getElementById("category-title");
            categoryTitle.innerText = `${category} Buddies`;
            const categoryBuddies = document.getElementById("category-buddies");
            categoryBuddies.innerHTML = "";
            buddies.forEach((buddy, index) => {
                if (buddy.category === category && !buddy.purchased) {
                    const buddyDiv = document.createElement("div");
                    buddyDiv.className = "buddy";
                    buddyDiv.innerHTML = `
                        <img src="${buddy.imageURL}" alt="${buddy.name}">
                        <div>
                            <span>${buddy.name} (${buddy.cost} coins) <span class="rarity ${getRarityClass(buddy.rarity)}">${buddy.rarity}</span></span><br>
                            <button class="action-button" onclick="buyBuddy(${index}, event)">Buy</button>
                        </div>
                    `;
                    categoryBuddies.appendChild(buddyDiv);
                }
            });
        }

        function showHearts(event) {
            const rect = event.currentTarget.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            for (let i = 0; i < 3; i++) {
                const heart = document.createElement("span");
                heart.className = "heart";
                heart.innerHTML = "❤️";
                heart.style.left = `${centerX + (Math.random() - 0.5) * 20}px`;
                heart.style.top = `${centerY - 20 - Math.random() * 20}px`;
                document.body.appendChild(heart);
                setTimeout(() => heart.remove(), 1000);
            }
        }

        function renderCollection() {
            const collectionList = document.getElementById("collection-list");
            collectionList.innerHTML = "";
            const collected = buddies.filter(r => r.purchased).length;
            const total = buddies.length;
            document.getElementById("collection-count").innerText = `${collected}/${total}`;
            
            const categories = {};
            buddies.forEach(buddy => {
                if (buddy.purchased) {
                    if (!categories[buddy.category]) {
                        categories[buddy.category] = [];
                    }
                    categories[buddy.category].push(buddy);
                }
            });

            for (const category in categories) {
                const categoryDiv = document.createElement("div");
                categoryDiv.className = "category-group";
                categoryDiv.innerHTML = `<h3>${category}</h3>`;
                const itemsDiv = document.createElement("div");
                categories[category].forEach((buddy, index) => {
                    const collectionDiv = document.createElement("div");
                    collectionDiv.className = "collection-item";
                    const currentLevel = buddy.level || 1;
                    collectionDiv.innerHTML = `
                        <div class="title-container">
                            <img src="${buddy.imageURL}" alt="${buddy.name}">
                            <span>${buddy.name} <span class="rarity ${getRarityClass(buddy.rarity)}">${buddy.rarity}</span></span>
                        </div>
                        <div class="upgrade-container">
                            <span class="level">Level ${currentLevel}</span>
                            <button class="upgrade-btn" onclick="upgradeBuddy(${buddies.indexOf(buddy)})" ${currentLevel >= 10 ? 'disabled' : ''} title="Upgrade (${10 * currentLevel} coins)">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <span class="upgrade-cost"><i class="fas fa-sack-dollar"></i> ${10 * currentLevel}</span>
                        </div>
                    `;
                    collectionDiv.addEventListener('click', showHearts);
                    itemsDiv.appendChild(collectionDiv);
                });
                categoryDiv.appendChild(itemsDiv);
                collectionList.appendChild(categoryDiv);
            }
        }

        function getRarityClass(rarity) {
            switch (rarity) {
                case "Common": return "rarity-common";
                case "Uncommon": return "rarity-uncommon";
                case "Rare": return "rarity-rare";
                case "Epic": return "rarity-epic";
                case "Legendary": return "rarity-legendary";
                case "Mythic": return "rarity-mythic";
                default: return "rarity-common";
            }
        }

        function addTask() {
            const taskInput = document.getElementById("new-task");
            const taskText = taskInput.value.trim();
            if (taskText !== "") {
                tasks.push({ text: taskText, completed: false });
                taskInput.value = "";
                renderTasks();
            }
        }

        function completeTask(index) {
            if (usePasscode) {
                pendingTaskIndex = index;
                showPasscodePopup(false);
            } else {
                completeTaskWithPasscode(index);
            }
        }

        function completeTaskWithPasscode(index) {
            tasks[index].completed = true;
            const taskDiv = document.getElementById("task-list").children[index];
            if (taskDiv) taskDiv.classList.add("completed");
            taskCoins += 10;
            tasksCompleted += 1;
            // coinSound.play().catch(() => console.log("Audio play failed"));
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
            setTimeout(() => {
                tasks.splice(index, 1);
                updateCoins();
                renderTasks();

                if (tasksCompleted % tasksPerLevel === 0) {
                    accountLevel += 1;
                    taskCoins += 50;
                    updateCoins();
                    showLevelUpNotification(accountLevel);
                }
                updateAccountLevel();

                showNotification("Task completed!");
            }, 500);
        }

        function buyBuddy(index, event) {
            const buddy = buddies[index];
            if (taskCoins >= buddy.cost && !buddy.purchased) {
                taskCoins -= buddy.cost;
                buddy.purchased = true;
                buddy.level = 1;
                // coinSound.play().catch(() => console.log("Audio play failed"));
                const buddyDiv = event.target.closest('.buddy');
                buddyDiv.classList.add("purchased");

                const rect = buddyDiv.getBoundingClientRect();
                const x = (rect.left + rect.width / 2) / window.innerWidth;
                const y = (rect.top + rect.height / 2) / window.innerHeight;
                confetti({
                    particleCount: 20,
                    spread: 50,
                    origin: { x, y },
                    shapes: ['emoji'],
                    emojis: ['💵'],
                    scalar: 1.5,
                    gravity: 0.5,
                    ticks: 200,
                    disableForReducedMotion: true,
                    angle: 90,
                    drift: 0,
                    startVelocity: 10,
                    decay: 0.95
                });

                setTimeout(() => {
                    updateCoins();
                    showCategoryBuddies(buddy.category);
                    renderCollection();
                    saveBuddies();
                }, 500);
            } else if (taskCoins < buddy.cost) {
                showNotification("Not enough Task Coins!");
            }
        }

        function upgradeBuddy(index) {
            const buddy = buddies[index];
            const currentLevel = buddy.level || 1;
            const upgradeCost = 10 * currentLevel;

            if (currentLevel >= 10) {
                showNotification(`${buddy.name} is already at max level!`);
                return;
            }

            if (taskCoins >= upgradeCost) {
                taskCoins -= upgradeCost;
                buddy.level = currentLevel + 1;
                // coinSound.play().catch(() => console.log("Audio play failed"));
                updateCoins();
                renderCollection();
                saveBuddies();
                showNotification(`${buddy.name} upgraded to Level ${buddy.level}!`);
            } else {
                showNotification(`Need ${upgradeCost} coins to upgrade ${buddy.name}!`);
            }
        }

        function findBuddyIndexInCollection(buddyIndex) {
            const purchasedBuddies = buddies.filter(b => b.purchased);
            return purchasedBuddies.indexOf(buddies[buddyIndex]);
        }

        function startTimer() {
            if (!timerInterval) {
                const minutesInput = document.getElementById("timer-minutes");
                const minutes = parseInt(minutesInput.value);
                
                if (isNaN(minutes) || minutes <= 0) {
                    showNotification("Please enter a positive number of minutes!");
                    minutesInput.value = "";
                    return;
                }
                
                timerDuration = minutes * 60;
                timeLeft = timerDuration;
                document.getElementById("start-timer").style.display = "none";
                document.getElementById("end-timer").style.display = "inline";
                const progressBar = document.getElementById("progress-bar");
                const progressFill = document.getElementById("progress-fill");
                progressBar.style.display = "block";
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay();
                    const progress = (timerDuration - timeLeft) / timerDuration;
                    progressFill.style.width = `${progress * 100}%`;
                    if (timeLeft <= 0) {
                        endTimer(true);
                    }
                }, 1000);
            }
        }

        function endTimer(completed = false) {
            clearInterval(timerInterval);
            timerInterval = null;
            document.getElementById("start-timer").style.display = "inline";
            document.getElementById("end-timer").style.display = "none";
            const progressBar = document.getElementById("progress-bar");
            const progressFill = document.getElementById("progress-fill");
            progressBar.style.display = "none";
            progressFill.style.width = "0%";
            document.getElementById("timer-minutes").value = "";
            timeLeft = 0;
            updateTimerDisplay();
            if (completed) {
                showNotification("Great job! Timer finished!");
                taskCoins += 25;
                updateCoins();
            } else {
                showNotification("Timer cancelled!");
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById("timer-display").innerText = 
                `${minutes < 10 ? "0" + minutes : minutes}:${seconds < 10 ? "0" + seconds : seconds}`;
        }

        function showSection(sectionId) {
            const sections = ["task-section", "timer-section", "buddies-section", "category-buddies-section", "collection-section"];
            sections.forEach(id => {
                document.getElementById(id).style.display = id === sectionId ? "block" : "none";
            });
        }

        function claimDailyReward() {
            const today = new Date().toDateString();
            if (lastRewardDate === today) {
                showNotification("You've already claimed your daily reward today!");
                return;
            }

            const rewardAmount = Math.min(streak * 10, 100);
            taskCoins += rewardAmount;
            lastRewardDate = today;
            localStorage.setItem("lastRewardDate", lastRewardDate);
            updateCoins();
            updateDailyRewardButton();
            showNotification(`Daily Reward Claimed: +${rewardAmount} coins!`);
        }

        function updateDailyRewardButton() {
            const today = new Date().toDateString();
            const rewardButton = document.getElementById("daily-reward-btn");
            if (lastRewardDate === today) {
                rewardButton.disabled = true;
                rewardButton.title = "Reward already claimed today!";
            } else {
                rewardButton.disabled = false;
                rewardButton.title = `Claim ${Math.min(streak * 10, 100)} coins!`;
            }
        }

        function updateDailyRewardTimer() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setHours(0, 0, 0, 0);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const timeLeftMs = tomorrow - now;
            
            const hours = Math.floor(timeLeftMs / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeftMs % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeftMs % (1000 * 60)) / 1000);
            
            document.getElementById("daily-reward-timer").innerText = 
                `Next reward in: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            if (timeLeftMs <= 0) {
                updateDailyRewardButton();
            }
        }

        getRandomRecommendedTasks();

        document.getElementById("shuffle-tasks").addEventListener("click", () => {
            getRandomRecommendedTasks();
        });

        updateCoins();
        updateStreak();
        updateAccountLevel();
        renderTasks();
        renderCollection();
        updateTimerDisplay();
        updateDailyRewardButton();
        updateDailyRewardTimer();
        setInterval(updateDailyRewardTimer, 1000);

        document.getElementById("new-task").addEventListener("keypress", function(e) {
            if (e.key === "Enter") {
                addTask();
            }
        });

        document.getElementById("passcode-input").addEventListener("input", function(e) {
            if (this.value.length > 4) {
                this.value = this.value.slice(0, 4);
            }
        });
    </script>
</body>
</html>